---
title: "â˜…Dockerã§reactÃ—postgresqlã®ç’°å¢ƒã‚’ä½œã‚‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«â˜…"
emoji: "ğŸ‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [react, typescript, docker]
published: false
---

## å°å…¥
Dockerã€Docker Compose ã§ Reactãƒ»Expressãƒ»Prismaãƒ»PostgreSQL ã‚’ã¾ã¨ã‚ã¦ç«‹ã¡ä¸Šã’ã‚‹
ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ç’°å¢ƒã®ä½œã‚Šæ–¹ã‚’ã€ä¸€æ­©ãšã¤è¾¿ã‚Œã‚‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã™ã€‚
æœ€çµ‚çš„ã«ã¯ `docker compose up -d` ã‚’å®Ÿè¡Œã™ã‚‹ã¨
`http://localhost:5173` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã ã‘ã§ PostgreSQL ã‹ã‚‰å–å¾—ã—ãŸã‚¿ã‚¹ã‚¯ä¸€è¦§ãŒ React ã®ç”»é¢ã«æç”»ã•ã‚Œã‚‹çŠ¶æ…‹ã‚’å†ç¾ã—ã¾ã™ã€‚

![GIFã®èª¬æ˜](/images/Videotogif%20(20).gif)

![ç”»åƒã®èª¬æ˜](/images/image.png)


### å­¦ã¹ã‚‹ã“ã¨
- Docker Compose ã‚’ä½¿ã£ã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä¸€ä½“ã§èµ·å‹•ã™ã‚‹æ‰‹é †ã¨è€ƒãˆæ–¹
- Express ã¨ Prisma ã‚’çµ„ã¿åˆã‚ã›ã¦ DB ã®ãƒ‡ãƒ¼ã‚¿ã‚’ API çµŒç”±ã§æ‰±ã†å®Ÿè·µçš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã‚‚å†ç¾æ€§é«˜ããƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯é–‹ç™ºã‚’å§‹ã‚ã‚‹ãŸã‚ã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ

## å‰æã¨æº–å‚™ç‰©

### æƒ³å®šèª­è€…ã¨å‰æçŸ¥è­˜
- Web ã‚¢ãƒ—ãƒªé–‹ç™ºã®åŸºæœ¬ï¼ˆReact ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹é€ ã‚„ Express ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãªã©ï¼‰ã‚’ä¸€é€šã‚Šè§¦ã£ãŸã“ã¨ãŒã‚ã‚‹
- Docker ã‚„ Prismaã€PostgreSQL ã‚’å˜ä½“ã§è©¦ã—ãŸã“ã¨ã¯ã‚ã‚‹ãŒã€è¤‡æ•°ã‚¹ã‚¿ãƒƒã‚¯ã‚’çµ„ã¿åˆã‚ã›ã¦å‹•ã‹ã™ã®ã¯åˆæŒ‘æˆ¦
- CLI ã§ã®ä½œæ¥­ã‚„å„ç¨®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†ã«æŠµæŠ—ãŒãªã„

æœ¬ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ã‚³ãƒ³ãƒ†ãƒŠã®æ¦‚å¿µã‚„ REST API ã®åŸºç¤ã‚’ã‚¼ãƒ­ã‹ã‚‰è§£èª¬ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ã¾ã£ãŸãã®æœªçµŒé¨“ã‹ã‚‰å­¦ã³ãŸã„å ´åˆã¯ã€å…ˆã«å„æŠ€è¡“ã®å…¥é–€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§é›°å›²æ°—ã‚’æ´ã‚“ã§ãŠãã¨å®‰å¿ƒã§ã™ã€‚

### ç”¨æ„ã—ã¦ãŠãç’°å¢ƒ
- Docker Desktop ã‚‚ã—ãã¯ Docker Engine ã¨ Docker Compose v2
- Node.js
    - ä»Šå›ã¯22.16.0
- npm ã¾ãŸã¯ pnpmï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ npm ã‚’æƒ³å®šï¼‰

æ‰‹å…ƒã®ç’°å¢ƒã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèªã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```bash
docker --version
docker compose version
node --version
npm --version
```

Docker ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã¨ã€`docker compose` ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã“ã¨ã‚’äº‹å‰ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãŠãã¨ã€å¾Œç¶šã®æ‰‹é †ã§ã®ã¤ã¾ãšãã‚’æ¸›ã‚‰ã›ã¾ã™ã€‚WSL2 ã‚„ãƒªãƒ¢ãƒ¼ãƒˆç’°å¢ƒã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ã‚„ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®šãŒæƒ³å®šã©ãŠã‚Šã«æ©Ÿèƒ½ã™ã‚‹ã‹ã‚‚åˆã‚ã›ã¦ç¢ºèªã—ã¦ãŠãã¨å®‰å¿ƒã§ã™ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“åƒ

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆæœ¬è¨˜äº‹ã§è§¦ã‚‹ç¯„å›²ï¼‰
ä»Šå›ã®æ‰‹é †ã§æ“ä½œã™ã‚‹ä¸»ãªãƒ•ã‚¡ã‚¤ãƒ«ã«çµã‚Šã€å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé †ã«ä¸¦ã¹ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
å…¨ä½“ã®ãƒ„ãƒªãƒ¼ã¯åˆ¥é€”æ²è¼‰äºˆå®šã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```text
â”œâ”€â”€ .env
â”œâ”€â”€ Dockercompose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ package.json
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â””â”€â”€ seed.js
â””â”€â”€ src/
    â”œâ”€â”€ API/
    â”‚   â””â”€â”€ index.ts
    â”œâ”€â”€ App.tsx
    â””â”€â”€ server/
        â””â”€â”€ server.js
```

æœ¬å½“ã¯ã“ã‚“ãªæ„Ÿã˜

![ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](/images/dir.png)

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®githubã‚‚ã‚ã‚Šã¾ã™ã®ã§cloneã—ã¦ã„ãŸã ã‘ã‚Œã°æ‰‹å…ƒã®ãƒã‚·ãƒ³ã§å†ç¾ã§ãã¾ã™ã€‚

https://github.com/

### ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆã¨å½¹å‰²

![ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](/images/containerRel.png)

- `web` ã‚³ãƒ³ãƒ†ãƒŠ: Vite ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’ 5173 ç•ªãƒãƒ¼ãƒˆã§èµ·å‹•ã—ã€React ã§ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’æç”»ã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã¯ãƒ›ã‚¹ãƒˆã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ãƒœãƒªãƒ¥ãƒ¼ãƒ å…±æœ‰ã—ã¦ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ãŒåŠ¹ãæ§‹æˆã§ã™ã€‚
- `api` ã‚³ãƒ³ãƒ†ãƒŠ: Express ã‚µãƒ¼ãƒãƒ¼ï¼ˆ`server.js`ï¼‰ã‚’èµ·å‹•ã—ã€Prisma ã§ PostgreSQL ã«æ¥ç¶šã—ã¦ã‚¿ã‚¹ã‚¯ã® CRUD API ã‚’æä¾›ã—ã¾ã™ã€‚`DATABASE_URL` ã¯ Compose ã§ `db` ã‚³ãƒ³ãƒ†ãƒŠã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
- `db` ã‚³ãƒ³ãƒ†ãƒŠ: PostgreSQL ã®å…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã€ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–ã—ã¾ã™ã€‚`db-data` ãƒœãƒªãƒ¥ãƒ¼ãƒ ã§ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä¿æŒã—ã€å†èµ·å‹•ã—ã¦ã‚‚å†…å®¹ãŒæ¶ˆãˆãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

Compose ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ `api` ãŒ `db` ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Œäº†ã‚’å¾…ã£ã¦ã‹ã‚‰èµ·å‹•ã—ã€`web` ã¯ `api` ã«ä¾å­˜ã™ã‚‹ã‚ˆã†ã«è¨­å®šã€‚ã“ã‚Œã«ã‚ˆã‚Šã€API ã‚„ DB ã®æº–å‚™ãŒæ•´ã†å‰ã«ãƒ•ãƒ­ãƒ³ãƒˆãŒæ¥ç¶šã‚¨ãƒ©ãƒ¼ã‚’å‡ºã™å•é¡Œã‚’é¿ã‘ã¦ã„ã¾ã™ã€‚

### ä¸»ãªãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ å†æ²

```text
â”œâ”€â”€ .env
â”œâ”€â”€ Dockercompose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ package.json
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â””â”€â”€ seed.js
â””â”€â”€ src/
    â”œâ”€â”€ API/
    â”‚   â””â”€â”€ index.ts
    â”œâ”€â”€ App.tsx
    â””â”€â”€ server/
        â””â”€â”€ server.js
```â”€â”€ vite.svg
```

- `.env`: aokaokaokaã€‚
- `Dockerfile`: Node.js ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…ƒã« `/code` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã‚¢ãƒ—ãƒªä¸€å¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã€web/api ä¸¡æ–¹ã®ã‚³ãƒ³ãƒ†ãƒŠã§å…±é€šã—ã¦ä½¿ã†ãƒ™ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚
- `compose.yml`: `web`ãƒ»`api`ãƒ»`db` ã® 3 ã‚µãƒ¼ãƒ“ã‚¹ã¨ `db-data` ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å®šç¾©ã€‚ãƒãƒ¼ãƒˆå…¬é–‹ã€ç’°å¢ƒå¤‰æ•°ã€ä¾å­˜é–¢ä¿‚ã®æŒ‡å®šãªã©å®Ÿè¡Œæ™‚ã®æŒ™å‹•ã‚’ã“ã“ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã¾ã™ã€‚
- `server.js`: Express ã‚¢ãƒ—ãƒªã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã€‚Prisma Client ã§ `Task` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ“ä½œã—ã€`GET /api/tasks` ã¨ `POST /api/tasks` ã‚’å…¬é–‹ã—ã¾ã™ã€‚
- `prisma/schema.prisma`: ãƒ¢ãƒ‡ãƒ«å®šç¾©ã€‚ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚„èª¬æ˜ã€ä½œæˆæ—¥æ™‚ãªã©ã‚’æŒã¤ `Task` ãƒ¢ãƒ‡ãƒ«ã‚’è¨˜è¿°ã—ã€`prisma migrate` ã§ DB ã«åæ˜ ã•ã›ã¾ã™ã€‚
- `src/API/index.ts`: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ API ã‚’å©ããŸã‚ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã€‚é–‹ç™ºç’°å¢ƒã§ã¯ `http://localhost:3001` ã‚’ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã¯ `http://api:3001` ã‚’ãƒ™ãƒ¼ã‚¹ URL ã«é¸æŠã—ã¦ã„ã¾ã™ã€‚
- `src/App.tsx`: `getTasks` ã‚’ä½¿ã£ã¦ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’å–å¾—ã—ã€React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æç”»ã™ã‚‹ UI ã®ä¸­æ ¸ã§ã™ã€‚

ã“ã®å…¨ä½“åƒã‚’æŠ¼ã•ãˆã¦ãŠãã¨ã€ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹ã¨ã©ã®ã‚³ãƒ³ãƒ†ãƒŠã«å½±éŸ¿ãŒå‡ºã‚‹ã®ã‹ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ãªãŒã‚‰èª­ã¿é€²ã‚ã‚‰ã‚Œã¾ã™ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—1: ãƒªãƒã‚¸ãƒˆãƒªåˆæœŸåŒ–ã¨ãƒ™ãƒ¼ã‚¹è¨­å®š
ã¾ãšã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ React + TypeScript ã®é–‹ç™ºç’°å¢ƒã‚’ç”¨æ„ã—ã€Vite ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒæ­£ã—ãå‹•ãã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç½®ããŸã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```bash
npm create vite@latest
```

å¯¾è©±å¼ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€æ¬¡ã®ã‚ˆã†ã«é¸æŠã—ã¾ã™ã€‚

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ï¼ˆä¾‹: `react-docker-prisma`ï¼‰
2. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã« `React` ã‚’é¸ã¶
3. ãƒãƒªã‚¢ãƒ³ãƒˆã¯ `TypeScript`ï¼ˆ`TypeScript + SWC` ã§ã¯ãªããƒ—ãƒ¬ãƒ¼ãƒ³ãª TypeScriptï¼‰ã‚’é¸ã¶

ç”ŸæˆãŒå®Œäº†ã—ãŸã‚‰ã€æ¡ˆå†…ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã§ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
cd react-docker-prisma
npm install
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5173` ã‚’é–‹ãã€Vite ã®åˆæœŸç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
![viteæ­£å¸¸èµ·å‹•å¾Œã®ç”»åƒ](/images/viteAndReactLogo.png)
ã“ã“ã¾ã§ãŒã§ãã‚Œã°ã€React + TypeScript ã®åœŸå°ãŒæ•´ã„ã¾ã—ãŸã€‚
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰ Docker åŒ–ã®ä½œæ¥­ã«å…¥ã£ã¦ã„ãã¾ã™ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—2: Docker åŸºç›¤ã¥ãã‚Šï¼ˆweb ã‚³ãƒ³ãƒ†ãƒŠï¼‰
ã“ã“ã‹ã‚‰ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ã„ã¦ã„ã‚‹ Vite ã‚¢ãƒ—ãƒªã‚’ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã—ã€Docker ä¸Šã§ã‚‚åŒã˜ç”»é¢ãŒè¡¨ç¤ºã§ãã‚‹ã‹ã‚’ç¢ºã‹ã‚ã¾ã™ã€‚ã¾ãšã¯ web ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ `Dockerfile` ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«ç”¨æ„ã—ã¾ã—ã‚‡ã†ã€‚

```Dockerfile
FROM node:22.20.0
WORKDIR /code
COPY package.json /code/
RUN npm install
COPY . /code/
```

æœ€å°æ§‹æˆã§ã™ãŒã€æ¬¡ã®ãƒã‚¤ãƒ³ãƒˆã‚’æŠ¼ã•ãˆã¦ã„ã¾ã™ã€‚
- `node:22.20.0` ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ›ã‚¹ãƒˆç’°å¢ƒã«ä¾å­˜ã›ãšåŒã˜ Node.js ã‚’ä½¿ã„å›ã›ã‚‹
- ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ `/code` ã«å›ºå®šã—ã¦ã€ä»¥é™ã®ã‚³ãƒãƒ³ãƒ‰ã®ãƒ«ãƒ¼ãƒˆã‚’æƒãˆã‚‹
- å…ˆã« `package.json` ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ `npm install` ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ä¾å­˜é–¢ä¿‚ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åŠ¹ã‹ã›ã‚‹ï¼ˆãã®å¾Œã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼ï¼‰

ç¶šã„ã¦ `Dockercompose.yml` ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«ç”¨æ„ã—ã¾ã—ã‚‡ã†ã€‚
ãã—ã¦ `web` ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¿½åŠ ã—ã¾ã™ã€‚
å¾Œç¶šã‚¹ãƒ†ãƒƒãƒ—ã§ `apiã‚µãƒ¼ãƒ“ã‚¹` ã‚„ `dbã‚µãƒ¼ãƒ“ã‚¹` ã‚’è¶³ã—ã¾ã™ãŒã€ã¾ãšã¯ãƒ•ãƒ­ãƒ³ãƒˆå˜ä½“ã®èµ·å‹•ã«é›†ä¸­ã—ã¾ã™ã€‚

```yaml
services:
  web:
    build: .
    command: npm run dev -- --host --port 5173
    volumes:
      - .:/code
    ports:
      - "5173:5173"
```

- `build: .` ã§å…ˆã»ã©ã® `Dockerfile` ã‚’ä½¿ã£ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’çµ„ã¿ç«‹ã¦ã¾ã™
- `command` ã« `--host` ã‚’ä»˜ã‘ã¦ã„ã‚‹ã®ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠå¤–ï¼ˆãƒ›ã‚¹ãƒˆï¼‰ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å—ã‘ä»˜ã‘ã‚‹ãŸã‚ã§ã™
  - æ³¨æ„ï¼šã“ã‚ŒãŒãªã„ã¨ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã‚„å¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å—ã‘ä»˜ã‘ãªã„ã®ã§å¿…ãšè¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚
- `volumes: .:/code` ã§ãƒ›ã‚¹ãƒˆã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨åŒæœŸã•ã›ã€React ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹ã¨ã‚³ãƒ³ãƒ†ãƒŠå´ã§ã‚‚å³æ™‚åæ˜ ã•ã‚Œã¾ã™
- `ports` ã§ãƒ›ã‚¹ãƒˆã® 5173 ç•ªãƒãƒ¼ãƒˆã‚’å…¬é–‹ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™

è¨­å®šãŒã§ããŸã‚‰ã€web ã‚µãƒ¼ãƒ“ã‚¹ã ã‘ã‚’èµ·å‹•ã—ã¦æŒ™å‹•ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
docker compose up -d web
```

åˆå›ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãŒå…¥ã‚‹ã®ã§å°‘ã—æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚èµ·å‹•å¾Œã«ãƒ­ã‚°ã‚’ç¢ºèªã—ã€Vite ãŒ `5173` ã§å¾…ã¡å—ã‘ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºã‹ã‚ã¾ã—ã‚‡ã†ã€‚

```bash
docker compose logs -f web
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5173` ã‚’é–‹ãã¨ã€ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§å‹•ã„ã¦ã„ã‚‹ Vite ã®åˆæœŸç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![viteæ­£å¸¸èµ·å‹•å¾Œã®ç”»åƒ](/images/viteAndReactLogo.png)

Step1 ã§ç¢ºèªã—ãŸãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œã¨åŒã˜è¦‹ãŸç›®ã«ãªã‚Œã°ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã¯æˆåŠŸã§ã™ã€‚
ã“ã“ã¾ã§ã®æ™‚ç‚¹ã§ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚„ DB ã¯ã¾ã ç”¨æ„ã—ã¦ã„ãªã„ã®ã§ã€ãã®ã¾ã¾ `docker compose down` ã§ä¸€åº¦åœæ­¢ã—ã¦æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—3: PostgreSQL Ã— Prisma è¨­å®š
ç¶šã„ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç”¨æ„ã—ã€Prisma çµŒç”±ã§æ‰±ãˆã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚ã¾ãšã¯å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```bash
npm install prisma @prisma/client --save-dev
```

æ¬¡ã« Prisma ã®åˆæœŸè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚PostgreSQL ã‚’ä½¿ã„ãŸã„ã®ã§ã€`--datasource-provider` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã—ã¾ã™ã€‚

```bash
npx prisma init --datasource-provider postgresql
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã« `prisma/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã€`prisma/schema.prisma` ã¨ `.env` ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ `env("DATABASE_URL")` ã‚’é€šã˜ã¦æ¥ç¶šæƒ…å ±ã‚’å‚ç…§ã™ã‚‹è¨˜è¿°ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€`.env` ã«æ­£ã—ã„æ¥ç¶šæ–‡å­—åˆ—ã‚’æ›¸ãè¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

PostgreSQL ã®æ¥ç¶šæ–‡å­—åˆ—ã¯ä»¥ä¸‹ã®å½¢å¼ã§ã™ã€‚

```
postgresql://USER:PASSWORD@HOST:PORT/DATABASE
```
è©³ç´°ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
ä»–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®éš›ã¯ã©ã†æ¥ç¶šã™ã‚‹ã‹ç­‰ã®æƒ…å ±ã‚‚ã‚ã‚Šã¾ã™ã€‚
https://www.prisma.io/docs/orm/overview/databases/postgresql

Compose ã§ç«‹ã¡ä¸Šã’ã‚‹ DB ã‚³ãƒ³ãƒ†ãƒŠã¨åˆã‚ã›ã‚‹ãŸã‚ã«ã€`.env` ã‚’æ¬¡ã®ã‚ˆã†ã«æ•´ãˆã¾ã™ã€‚

```env
DATABASE_URL="postgresql://postgres:postgres@db:5432/react_develop"
```

- `USER` / `PASSWORD` / `DATABASE` ã¯ Compose ã® `db` ã‚µãƒ¼ãƒ“ã‚¹ã§è¨­å®šã™ã‚‹ `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB` ã¨ä¸€è‡´ã•ã›ã¾ã™
- `HOST` ã¯ Compose å†…ã§ã®ã‚µãƒ¼ãƒ“ã‚¹åï¼ˆ`db`ï¼‰ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ãƒŠé–“ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¶Šã—ã«æ¥ç¶šã§ãã¾ã™
- `PORT` ã¯ PostgreSQL ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 5432 ã‚’ä½¿ç”¨ã—ã¾ã™

ã‚ˆã£ã¦`Dockercompose.yml` ã® `db` ã‚µãƒ¼ãƒ“ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½è¨˜ã—ã¾ã™ã€‚

```yaml
services:
  db:
    image: postgres
    platform: linux/amd64
    volumes:
      - db-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_DB=react_develop
      - POSTGRES_PASSWORD=postgres
    healthcheck:
      test: "psql -U postgres"
      interval: 5s
      timeout: 5s
      retries: 5
```

å…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ã„ã€æ°¸ç¶šåŒ–ç”¨ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã™ã‚‹ã¨ `service_healthy` ã«ãªã‚Šã€å¾Œç¶šã® `api` ã‚µãƒ¼ãƒ“ã‚¹ã¯ãã‚Œã‚’å¾…ã£ã¦ã‹ã‚‰èµ·å‹•ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§æ´»ç”¨ï¼‰ã€‚

ã¤ã¥ã„ã¦ `schema.prisma` ã«ã‚¿ã‚¹ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚åˆæœŸç”Ÿæˆã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¬¡ã®å†…å®¹ã«å·®ã—æ›¿ãˆã¾ã—ã‚‡ã†ã€‚

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ä»¥ä¸‹ã‚’å·®ã—æ›¿ãˆ

model Task {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  completed   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã—ãŸã‚‰ã€å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åæ˜ ã—ã¾ã™ã€‚

```bash
npx prisma db push
```

ã‚³ãƒãƒ³ãƒ‰ãŒæˆåŠŸã™ã‚‹ã¨ `Task` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒ Postgres ã«ä½œæˆã•ã‚Œã€åŒæ™‚ã«Prisma Client ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
ã“ã®Prismaa Clientã‚’ã€å¾Œç¶šã®expressã®ç’°å¢ƒã§åˆ©ç”¨ã—ãƒ•ãƒ­ãƒ³ãƒˆã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®é€£æºã«åˆ©ç”¨ã—ã¾ã™ã€‚

æœ€å¾Œã«ã€DB ã‚³ãƒ³ãƒ†ãƒŠãŒæ­£ã—ãèµ·å‹•ã—ç¶šã‘ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

```bash
docker compose up -d db
docker compose logs db
```

ãƒ­ã‚°ã« `database system is ready to accept connections` ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚Œã°èµ·å‹•æˆåŠŸã§ã™ã€‚
`docker compose up -d` ã§ `web` ã‚’ä¸€ç·’ã«ç«‹ã¡ä¸Šã’ã¦ã‚‚ã€React å´ã¯ã“ã‚Œã¾ã§ã¨åŒã˜ã‚ˆã†ã«åˆæœŸç”»é¢ã‚’è¡¨ç¤ºã§ãã‚‹ã¯ãšã§ã™ã€‚
ã“ã“ã¾ã§ã§ Prisma ã‹ã‚‰ Postgres ã¸æ¥ç¶šã™ã‚‹åœŸå°ãŒæ•´ã„ã¾ã—ãŸã€‚
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ Express API ã‚’è¿½åŠ ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ DB ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã€‚

ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦ã¯æœ€å¾Œã®è¨­å®šã«ãªã‚Šã¾ã™ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—4: Express API å®Ÿè£…
Prisma ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™ãŒæ•´ã£ãŸã®ã§ã€React ã‹ã‚‰æ‰±ãˆã‚‹ã‚ˆã†ã« Express API ã‚’è¿½åŠ ã—ã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã¨ DB ã®æ©‹æ¸¡ã—å½¹ã¨ã—ã¦ API ã‚µãƒ¼ãƒãƒ¼ã‚’ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã—ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã§ã‚¿ã‚¹ã‚¯ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

### Compose ã« `api` ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¿½åŠ 
`Dockercompose.yml` ã« API ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚`db` ãŒèµ·å‹•ã—ã¦ã‹ã‚‰ç«‹ã¡ä¸ŠãŒã‚‹ã‚ˆã† `depends_on` ã‚‚è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

```yaml
services:
  api:
    build: .
    command: node src/server/server.js
    volumes:
      - .:/code
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@db:5432/react_develop
      - PORT=3000
    depends_on:
      db:
        condition: service_healthy
```

- `command` ã§ Express ã‚µãƒ¼ãƒãƒ¼ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡å®š
- `DATABASE_URL` ã¯ã‚¹ãƒ†ãƒƒãƒ—3ã§è¨­å®šã—ãŸæ–‡å­—åˆ—ã‚’ãã®ã¾ã¾æµç”¨ã—ã€Prisma ãŒ DB ã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
- `PORT=3000` ã‚’æ¸¡ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã®å¾…ã¡å—ã‘ãƒãƒ¼ãƒˆã‚’å›ºå®šï¼ˆãƒ›ã‚¹ãƒˆå´ã¸ã‚‚ 3000 ç•ªã§å…¬é–‹ï¼‰
- `depends_on` ã«ã‚ˆã‚Š DB ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã—ã¦ã‹ã‚‰ API ãŒèµ·å‹•ã™ã‚‹

ã“ã®æ®µéšã§ `web` ã‚µãƒ¼ãƒ“ã‚¹ã® `depends_on` ã« `api` ã‚’è¿½åŠ ã—ã¦ãŠãã¨ã€ãƒ•ãƒ­ãƒ³ãƒˆãŒ API èµ·å‹•å‰ã« 404 ã‚’è¿”ã™çŠ¶æ³ã‚’é¿ã‘ã‚‰ã‚Œã¾ã™ã€‚

```yaml
web:
    build: .
    command: npm run dev -- --host --port 5173
    volumes:
      - .:/code
    ports:
      - "5173:5173"
    # â†“ã“ã‚Œâ†“
    depends_on:
      - api
```

### `src/server/server.js` ã®ãƒ™ãƒ¼ã‚¹
API ã‚µãƒ¼ãƒãƒ¼ã§ã¯ Express ã¨ Prisma Client ã‚’çµ„ã¿åˆã‚ã›ã¦ DB ã¨ã‚„ã‚Šå–ã‚Šã—ã¾ã™ã€‚`src/server/server.js` ã¯æ¬¡ã®ã‚ˆã†ãªæ§‹æˆã«ã—ã¾ã™ã€‚

```js
import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';
import { PrismaClient } from '@prisma/client';

dotenv.config();

const app = express();
const prisma = new PrismaClient();
const PORT = 3000;

app.use(cors());

app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});
```

- `dotenv.config()` ã§ `.env` ã‚’èª­ã¿è¾¼ã¿ã€`DATABASE_URL` ã‚’å‚ç…§å¯èƒ½ã«ã—ã¦ã„ã¾ã™
- `app.use(cors())` ã‚’æœ‰åŠ¹ã«ã—ã¦ãŠãã¨ã€åˆ¥ãƒãƒ¼ãƒˆã§å‹•ããƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚‚è¨±å¯ã§ãã¾ã™
    - ä»Šå›ã®å ´åˆviteã®reactã‚¢ãƒ—ãƒªã¯5173ãƒãƒ¼ãƒˆã§å‹•ã‹ã—ã¦ã„ã¾ã™ã®ã§ã€ã“ã®è¨­å®šãŒãªã„ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ‹’å¦ã•ã‚Œã¾ã™
    - corsã«ã¤ã„ã¦ã¯è©³ç´°ã¯[ã“ã¡ã‚‰](https://developer.mozilla.org/ja/docs/Web/HTTP/Guides/CORS/Errors)ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„

### ã‚¿ã‚¹ã‚¯å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
Prisma Client ã‚’ä½¿ã£ã¦ã‚¿ã‚¹ã‚¯ã‚’å–å¾—ã—ã€API ã‹ã‚‰è¿”ã™å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç°¡å˜ã«å…¥ã‚Œã¦ãŠãã¨åŸå› èª¿æŸ»ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚

```js
app.get('/api/tasks', async (req, res) => {
  try {
    const tasks = await prisma.task.findMany();
    res.json(tasks);
  } catch (error) {
    console.error('Error fetching tasks:', error);
    res.status(500).json({ error: 'Failed to fetch tasks' });
  }
});
```

ã“ã®æ®µéšã§ `npm run dev` ã‚’æ­¢ã‚ã€`docker compose up -d api` ã‚’å®Ÿè¡Œã™ã‚Œã° API ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¾ã™ã€‚
`docker compose logs -f api` ã§ `Server is running on port 3000` ãŒå‡ºã¦ã„ã‚Œã°æº–å‚™å®Œäº†ã§ã™ã€‚
è©¦ã—ã« `curl http://localhost:3000/api/tasks` ã‚’å©ãã¨ã€ç¾æ™‚ç‚¹ã§ã¯ç©ºé…åˆ— `[]` ãŒè¿”ã‚‹ã¯ãšã§ã™ã€‚
ãªãŠè©¦ã™å ´åˆã¯docker compose exec web bashã§ã‚³ãƒ³ãƒ†ãƒŠå†…ã®webã‚µãƒ¼ãƒ“ã‚¹ã§bashã‚’é–‹ã„ãŸå¾Œã«
`curl http://localhost:3000/api/tasks`ã‚’å©ã„ã¦ãã ã•ã„ã€‚

### ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã™ã‚‹
è¡¨ç¤ºç”¨ã®ãƒ‡ãƒ¼ã‚¿ãŒæ¬²ã—ã„å ´åˆã¯ã€`prisma/seed.js` ã‚’ä½¿ã£ã¦åˆæœŸã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ²ã—ã¦ãŠãã¾ã™ã€‚
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã®prisamaãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«seed.jsã‚’ä½œæˆã—
ä»¥ä¸‹ã®æ§˜ã«è¿½è¨˜ã—ã¦ãã ã•ã„ã€‚

```js
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

const main = async () => {

    const task1 = await prisma.task.create({
      data: {
        title: 'Prismaã§ä½œæˆã—ãŸã‚¿ã‚¹ã‚¯1',
        description: 'ã“ã‚Œã¯Prismaã®ã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ä½œæˆã•ã‚Œã¾ã—ãŸ',
        completed: false,
      },
    })

    console.log('Created tasks:', { task1 })
}

const runSeed = async () => {
  try {
    await main()
  } catch (e) {
    console.error('Error seeding database:', e)
    process.exit(1)
  } finally {
    await prisma.$disconnect()
  }
}

runSeed()
```

ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€API ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ãŸçŠ¶æ…‹ã§æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
docker compose exec api node prisma/seed.js
```

ã‚·ãƒ¼ãƒ‰ãŒçµ‚ã‚ã£ãŸã‚‰å†åº¦ `curl` ã‚„ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ `/api/tasks` ã‚’ç¢ºèªã—ã€ã‚¿ã‚¹ã‚¯ãŒé…åˆ—ã§è¿”ã£ã¦ãã‚‹ã“ã¨ã‚’ç¢ºã‹ã‚ã¾ã—ã‚‡ã†ã€‚
ã“ã‚Œã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒåˆ©ç”¨ã§ãã‚‹ API ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ•´ã„ã¾ã—ãŸã€‚

## ã‚¹ãƒ†ãƒƒãƒ—5: React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ API ã‚’å‘¼ã¶
API ãŒæ•´ã£ãŸã®ã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’å–å¾—ã—ã¦æç”»ã—ã¾ã™ã€‚ã“ã“ã§ã¯ API å‘¼ã³å‡ºã—ç”¨ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ã€`App.tsx` ã®æœ€ä½é™ã®å®Ÿè£…ã‚’ç¢ºèªã—ã¾ã™ã€‚

### ä»¥ä¸‹ã®å†…å®¹ã‚’App.tsxã«ã‚³ãƒ”ãƒšï¼ˆæ—¢å­˜ã®å†…å®¹ã¯å‰Šé™¤ã—ã¦ãã ã•ã„ï¼‰
```tsx
import { getTasks } from "./API"
import { useState, useEffect } from 'react'

type Task = {
  id: number,
  title: string,
  description: string,
  completed: boolean,
  createdAt: string,
  updatedAt: string,
}

const App = () => {
  const [tasks, setTasks] = useState<Task[]>([])
  const [loading, setLoading] = useState<boolean>(true)
  const [error, setError] = useState<Error | null>(null)

  useEffect(() => {
    const fetchTasks = async () => {
      try {
        const fetchedTasks = await getTasks()
        setTasks(fetchedTasks)
      } catch (err) {
        setError(err as Error)
      } finally {
        setLoading(false)
      }
    }
    fetchTasks()
  }, [])

  if (loading) return <h1>Loading tasks...</h1>
  if (error) return <h1>Error: {error.message}</h1>

  return (
    <>
    {/* ä¸­å¤®å¯„ã› */}
    <div style={{marginLeft: '200px', marginTop: '0px'}}>
      {tasks.map((task) => (
        <div key={task.id}>
          <h2>{task.title}</h2>
          <p>{task.description}</p>
        </div>
      ))}
    </div>
    </>
  )
}
export default App;
```

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆcssã®å‰Šé™¤

App.cssã¨index.cssãŒã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã€ä¸¡æ–¹ä¸è¦ãªã®ã§å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚

ã“ã“ã¾ã§åæ˜ ã—ãŸã‚‰ã€`docker compose up -d api db` ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’èµ·å‹•ã—ãŸçŠ¶æ…‹ã®ã¾ã¾ `docker compose up -d web` ã‚’å®Ÿè¡Œã—ã€
ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5173` ã‚’ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚
ã‚·ãƒ¼ãƒ‰æ¸ˆã¿ã®ã‚¿ã‚¹ã‚¯ãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚Œã°ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ API ã®é€£æºã¯å®Œäº†ã§ã™ã€‚

![ç”»åƒã®èª¬æ˜](/images/fetchSuccess.png)

ã“ã‚Œã§ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠã®é€£æºãŒå–ã‚Œã¾ã—ãŸã€‚
æœ€å¾Œã«ä¸€åº¦ç¾çŠ¶ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã—ã€
docker compose up -dã§å†èµ·å‹•ã—é€£æºãŒä¸€ç™ºã§å–ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—6: Docker Compose ã§ä¸€æ°—ã«èµ·å‹•
ã“ã“ã¾ã§ä½œæˆã—ãŸ `web`ãƒ»`api`ãƒ»`db` ã‚’ã¾ã¨ã‚ã¦ç«‹ã¡ä¸Šã’ã€ãƒ•ãƒ­ãƒ³ãƒˆç”»é¢ã‹ã‚‰ã‚¿ã‚¹ã‚¯ãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’æœ€çµ‚ç¢ºèªã—ã¾ã™ã€‚

### ä»Šã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã™ã‚‹

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç¾çŠ¶å‹•ã„ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’æ¶ˆã—ã¾ã—ã‚‡ã†ã€‚
```bash
docker compose down
```

### 3ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€æ°—ã«èµ·å‹•ã™ã‚‹

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ä»Šã¾ã§ä½œæˆã—ã¦3ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’åŒæ™‚ã«èµ·å‹•ã—ã¾ã™ã€‚
imageã¯ã™ã§ã«ã‚ã‚‹ã®ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒèµ°ã£ã¦æ¯”è¼ƒçš„é«˜é€Ÿã«ç«‹ã¡ä¸ŠãŒã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
```bash
docker compose up -d
```
### ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œã‚’ç¢ºèªã™ã‚‹
ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5173` ã‚’é–‹ãã€Prisma ã®ã‚·ãƒ¼ãƒ‰ã§æŠ•å…¥ã—ãŸã‚¿ã‚¹ã‚¯ãŒä¸€è¦§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸç¬é–“ã« `GET /api/tasks` ãŒå‘¼ã°ã‚Œã€API çµŒç”±ã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒæç”»ã•ã‚Œã‚‹æµã‚Œã«ãªã‚Šã¾ã™ã€‚

![ç”»åƒã®èª¬æ˜](/images/fetchSuccess.png)

ã‚‚ã—ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ä»¥ä¸‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
- `docker compose logs api` ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã‹ï¼ˆ`DATABASE_URL` ã®è¨­å®šæ¼ã‚Œãªã©ï¼‰
- `docker compose logs db` ã§ DB ãŒèµ·å‹•å®Œäº†ã—ã¦ã„ã‚‹ã‹
- ãƒ•ãƒ­ãƒ³ãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ `http://localhost:3000/api/tasks` ãŒæˆåŠŸã—ã¦ã„ã‚‹ã‹

å•é¡Œãªãè¡¨ç¤ºã§ããŸã‚‰ã€æœ€å¾Œã« `docker compose down` ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ã—ã¦ãŠãã¾ã™ã€‚
ã“ã‚Œã§ Docker Compose ã‚’ä½¿ã£ãŸ React Ã— Express Ã— Prisma Ã— PostgreSQL ã®ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ç’°å¢ƒæ§‹ç¯‰ã¯å®Œäº†ã§ã™ã€‚
ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚

ç–‘å•ç‚¹ç­‰ã‚ã‚Œã°ãŠæ°—è»½ã«ã‚³ãƒ¡ãƒ³ãƒˆãã ã•ã„ã€‚

## è£œè¶³

### ã‚‚ã£ã¨ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„ã—ã¦è©¦ã™

seed.jsã‚’ä»¥ä¸‹ã®æ§˜ã«ç·¨é›†ã—ã¦ãã ã•ã„

```js
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

const main = async () => {
  const task1 = await prisma.task.create({
    data: {
      title: 'ã‚¿ã‚¹ã‚¯1',
      description: '1ç•ªç›®ã®ã‚¿ã‚¹ã‚¯',
      completed: false,
    },
  })

  const task2 = await prisma.task.create({
    data: {
      title: 'ã‚¿ã‚¹ã‚¯2',
      description: '2ç•ªç›®ã®ã‚¿ã‚¹ã‚¯',
      completed: true,
    },
  })

  const task3 = await prisma.task.create({
    data: {
      title: 'ã‚¿ã‚¹ã‚¯3',
      description: '3ç•ªç›®ã®ã‚¿ã‚¹ã‚¯',
      completed: false,
    },
  })

  const task4 = await prisma.task.create({
    data: {
      title: 'ã‚¿ã‚¹ã‚¯4',
      description: '4ç•ªç›®ã®ã‚¿ã‚¹ã‚¯',
      completed: true,
    },
  })

  const task5 = await prisma.task.create({
    data: {
      title: 'ã‚¿ã‚¹ã‚¯5',
      description: '5ç•ªç›®ã®ã‚¿ã‚¹ã‚¯',
      completed: false,
    },
  })

  console.log('Created 5 tasks:', { task1, task2, task3, task4, task5 })
}

const runSeed = async () => {
  try {
    await main()
  } catch (e) {
    console.error('Error seeding database:', e)
    process.exit(1)
  } finally {
    await prisma.$disconnect()
  }
}

runSeed()
```

docker compose exec apiã‚’å®Ÿæ–½ã™ã‚‹

```bash
docker compose exec api node prisma/seed.js
```

ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ã„ã¦ã„ã‚‹5173ãƒãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã‚¿ãƒ–ã‚’å†èª­ã¿è¾¼ã¿ã™ã‚‹ã¨ä»¥ä¸‹ã®æ§˜ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![ç”»åƒã®èª¬æ˜](/images/moreSeed.png)
